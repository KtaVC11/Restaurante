jQuery(function(l){var u=[{obj:"#baum_greenpay-card-number",required:!0},{obj:"#baum_greenpay-card-cvc",required:!0},{obj:"#baum_greenpay-card-expiry",required:!0},{obj:"#baum_greenpay-card-holder",required:!0}],o=function(e,a){var r=l(".payment_box.payment_method_baum_greenpay").find("#"+e);return void 0!==a&&""!=a&&(r.length&&r.val(a),!0)},p=function(e,a){var r=0,n=l("form.woocommerce-checkout, form#add_payment_method");a.length&&(n=a),e.use_token||(null!=e.result&&null!=e.keyPairs&&(o("token_ld",e.result)||r++,o("token_lk",e.keyPairs)||r++),0==r&&l.each(u,function(e,a){var r=l(a.obj);a.required&&""==r.val()&&r.closest(".form-row").removeClass("woocommerce-validated").addClass("validate-required")})),n.submit()},s=function(e){var a=0;return l.each(e,function(e){""==l(this).val()?(l(this).closest(".form-row").addClass("validate-required woocommerce-invalid woocommerce-invalid-required-field"),a++):l(this).closest(".form-row").removeClass("validate-required woocommerce-invalid woocommerce-invalid-required-field")}),0==a};l(document).on("click","#place_order",function(){if(l("#wc-baum_greenpay-payment-token-new").length&&l("#wc-baum_greenpay-payment-token-new").prop("checked")||l("#payment_methods").length&&"baum_greenpay"==l("#payment_methods").val()||l("#payment_method_baum_greenpay").length&&l("#payment_method_baum_greenpay").prop("checked")||l("#add_payment_method").length)return function(e){var a=l(u[0].obj),r=l(u[1].obj),n=l(u[2].obj),o=l(u[3].obj),t=n.val().substring(0,2),c=n.val().substring(5),m={use_token:!0};if(l("#is-valid-cc").val("processing"),0==l(".wc-saved-payment-methods").length||l("#wc-baum_greenpay-payment-token-new").length&&l("#wc-baum_greenpay-payment-token-new").prop("checked")){if(!s([a,r,n,o]))return;var d={cardName:o.val(),cardExpirationMonth:{month:Number(t),year:c},cardNumber:a.val().split(" ").join(""),cardExpirationCVV:r.val()},i=formatCard(d);""!=JSON.parse(i).card.cardNumber?(m=encryptCard(JSON.parse(bgp_params.get_public_key),i)).use_token=!1:l("#is-valid-cc").val()}p(m,e)}(l(this).closest("form")),!1}),l(document).on("change","input.woocommerce-SavedPaymentMethods-tokenInput",function(){var e=l(this);e.prop("checked")&&"new"==e.val()?l("#collapse-cc-form").slideDown():l("#collapse-cc-form").slideUp()}),l("#add_payment_method").length&&l("#wc-baum_greenpay-payment-token-new").prop("checked",!0).trigger("change")});